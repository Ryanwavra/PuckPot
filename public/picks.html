<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PuckPot Picks</title>
    <link rel="stylesheet" href="global.css" />
    <link rel="stylesheet" href="picks.css" />
  </head>

  <body>
    <div class="app-container">
      <main>
        <!-- Header -->
        <section class="header-section">
          <div class="header">
            <div class="logo"><img src="/images/PuckPotLogo.png" /></div>
          </div>
        </section>

        <!-- Title -->
        <section class="title">
          <div>Make Your Picks:</div>
        </section>

        <!-- Countdown -->
        <section class="countdown-section">
          <div class="countdown">
            <div class="heading">PICKS LOCK IN:</div>
            <div class="countdown-content">
              <div class="time-block">
                <div id="hourCount">0</div>
                <div id="HRS">HRS</div>
              </div>
              <div class="time-block">
                <div id="minCount">0</div>
                <div id="MIN">MIN</div>
              </div>
              <div class="time-block">
                <div id="secCount">0</div>
                <div id="SEC">SEC</div>
              </div>
            </div>
          </div>
        </section>

        <!-- Pot Info -->
        <section>
          <div class="pot">
            <div class="total-players">
              Players Entered: <span id="player-count">0</span>
            </div>
            <div class="total-pot">
              Current Pot: <span id="total-amount">$0.00</span>
            </div>
          </div>
        </section>

        <!-- Games -->
        <section class="games-section">
          <h2>Today's Games:</h2>
          <div id="games-template" class="game-card" style="display: none;">
            <div class="game-header">
              <p class="game-date-time">DATE ‚Ä¢ TIME</p>
              <p class="game-status">Upcoming</p>
            </div>
            <div class="game-content">
              <div class="away-team">
                <div class="away-symbol"><h3>SYMBOL</h3></div>
                <div class="team-label"><p>AWAY</p></div>
              </div>
              <div><p>VS</p></div>
              <div class="home-team">
                <div class="home-symbol"><h3>SYMBOL</h3></div>
                <div class="team-label"><p>HOME</p></div>
              </div>
            </div>
          </div>
        </section>

        <!-- Tie Breaker -->
        <section>
          <div class="tie-guess">
            <div class="tie-guess-content">
              Total goals in highest scoring game of the day (tiebreaker):
            </div>
            <input
              type="number"
              id="tieBreaker"
              placeholder="Enter whole number: "
              min="0"
              required
            />
          </div>
        </section>

        <!-- Submit Button -->
        <section>
          <div class="button">
            <button id="submit-picks">Submit Picks</button>
          </div>
        </section>

        <!-- Wallet Status -->
        <div id="wallet-status">Checking wallet‚Ä¶</div>
      </main>

      <!-- Footer -->
      <footer class="footer">
        <a href="index.html">
          <div class="home-icon svg">üè†</div>
          <div class="home-word">Home</div>
        </a>
        <div class="picks">
          <div class="picks-icon svg">üéØ</div>
          <div class="picks-word">Picks</div>
        </div>
        <a href="rankingsbeta.html" class="rankings">
          <div class="rankings-icon svg">üèÜ</div>
          <div class="rankings-word">Rankings</div>
        </a>
        <a href="profilebeta.html" class="profile">
          <div class="profile-icon svg">üë§</div>
          <div class="profile-word">Profile</div>
        </a>
      </footer>
    </div>

    <!-- Load scripts -->
    <!-- Load MiniKit first -->
    <script src="https://cdn.jsdelivr.net/npm/@coinbase/minikit@latest/dist/minikit.umd.js"></script>

    <!-- Then your app scripts -->
    <script type="module" src="/scripts/picks.js"></script>
    <script src="/scripts/countdown.js"></script>
    <script>
      fetch("/api/games")
        .then((res) => res.json())
        .then((data) => {
          initCountdown(data.lock_time);
        });
    </script>
    <script src="/scripts/contestStats.js"></script>
    <script>
      function getContestIdClient() {
        const now = new Date();
        const est = new Date(
          now.toLocaleString("en-US", { timeZone: "America/New_York" })
        );
        const y = est.getFullYear();
        const m = String(est.getMonth() + 1).padStart(2, "0");
        const d = String(est.getDate()).padStart(2, "0");
        return `${y}-${m}-${d}`;
      }

      const contestId = getContestIdClient();
      console.log("Using contestId:", contestId);
      window.initContestStats(contestId);
    </script>

    <!-- Wallet init -->
    <script>
      document.addEventListener("DOMContentLoaded", async () => {
        const el = document.getElementById("wallet-status");
        if (window.MiniKit) {
          try {
            const address = await window.MiniKit.ethereum.getAddress();
            console.log("Connected wallet:", address);
            el.textContent = "Connected wallet: " + address;
          } catch (err) {
            console.error("Error fetching wallet:", err);
            el.textContent = "Error connecting wallet.";
          }
        } else {
          console.log("MiniKit not available (not inside Base app)");
          el.textContent = "MiniKit not available. Open in Base app.";
        }
      });
    </script>
  </body>
</html>